{% extends 'commons/base.html' %}
{% load static %}

{% block css %}
  <link rel="stylesheet" href="{% static 'css/info_pesquisa.css' %}">
  <link rel="stylesheet" href="{% static 'css/file_info_form.css' %}">
  <link rel="stylesheet" href="{% static 'css/trash_can.css' %}">
{% endblock css %}

{% block content %}

<div class="container-fluid relatorio-container">
  {% for x in obj %}
    <div class="card relatorio-card">

      <!-- Header Relatório -->
      <div class="relatorio-header">
        <div class="row align-items-center">
          <div class="col-auto">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="#4caf50" class="bi bi-leaf" viewBox="0 0 16 16">
              <path d="M11.78.033a.648.648 0 0 0-.154.054c-.868.31-1.435.901-2.675 2.997-.637 1.191-1.29 2.816-1.514 4.169.703 1.079 1.213 2.779 1.364 4.692.05.623.053 1.616-.032 2.205l-.422 3.12a.5.5 0 0 1-.983-.118l.414-3.076c.07-.52.071-1.429.02-2.004-.21-2.577-.923-4.287-2.056-5.305-.656.143-1.435.354-2.26.681-.779.316-1.598.799-2.213 1.402a.5.5 0 1 1-.707-.707c.652-.651 1.577-1.177 2.409-1.517.54-.218 1.111-.408 1.583-.487-.236-.81-.556-1.502-.973-2.015-.449-.552-1.036-.937-1.899-1.052a.5.5 0 0 1 .068-.993c1.104.126 1.928.619 2.513 1.304.31.381.555.852.738 1.41.326-.08.656-.17.984-.265 1.22-.368 2.287-.82 2.937-1.562.65-.743.886-1.667.886-2.867 0-.309-.038-.619-.11-.916a.5.5 0 1 1 .976-.191c.088.447.132.816.132 1.107 0 1.34-.273 2.401-1.078 3.287-.803.884-2.053 1.463-3.428 1.884.045.56.104 1.092.126 1.38.019.248.015.628-.057 1.183l-.422 3.12a.5.5 0 0 1-.983-.118l.414-3.076z"/>
            </svg>
          </div>
          <div class="col">
            <h2>
              <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" class="bi bi-file-earmark-text mb-2 me-2" viewBox="0 0 16 16">
                <path d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5"/>
                <path d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1z"/>
              </svg>
              Relatório de Pesquisa Ambiental
            </h2>
            <p class="fs-5">Informações Detalhadas da Pesquisa</p>
          </div>
        </div>
      </div>

      <div class="card-body p-5">

        <!-- Seção 1: Ação e UC -->
        <div class="secao">
          <h5>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-folder me-2" viewBox="0 0 16 16">
              <path d="M.54 3.87.5 3a2 2 0 0 1 2-2h3.672a2 2 0 0 1 1.414.586l2.828 2.828A2 2 0 0 0 9.828 6H14a2 2 0 0 1 2 2v.5H.5a.5.5 0 0 0 0 1H16V8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-.5zm5 1a1 1 0 0 0 0 2H2a1 1 0 0 0-1-1h4z"/>
            </svg>
            Identificação da Pesquisa
          </h5>
          <div class="row g-4">
            <div class="col-md-6">
              <div class="info-card info-card-green">
                <label>Ação Realizada</label>
                <p>{{ x.acao_realizada }}</p>
              </div>
            </div>
            <div class="col-md-6">
              <div class="info-card info-card-blue">
                <label>Unidade de Conservação</label>
                <p>{{ x.unidade_cons }}</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Seção 2: Tipo e Documentação -->
        <div class="secao">
          <h5>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-clipboard-check me-2" viewBox="0 0 16 16">
              <path fill-rule="evenodd" d="M10.854 7.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 9.793l2.646-2.647a.5.5 0 0 1 .708 0z"/>
              <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
              <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3z"/>
            </svg>
            Documentação e Autorização
          </h5>
          <div class="row g-4">
            <div class="col-md-4">
              <div class="info-card info-card-purple">
                <label>Tipo de Solicitação</label>
                <p>{{ x.tipo_solic }}</p>
              </div>
            </div>
            <div class="col-md-4">
              <div class="info-card info-card-orange">
                <label>Fotografias da UC</label>
                <p>{{ x.foto }}</p>
              </div>
            </div>
            <div class="col-md-4">
              <div class="info-card info-card-pink">
                <label>Licença da Instituição</label>
                <p>{{ x.licenca_inst }}</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Seção 3: Período -->
        <div class="secao">
          <h5>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-calendar-event me-2" viewBox="0 0 16 16">
              <path d="M11 6.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5z"/>
              <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4z"/>
            </svg>
            Período de Execução
          </h5>
          <div class="info-card info-card-gray">
            <label>Duração</label>
            <p>{{ duracao_pesq }}</p>
          </div>
        </div>

        <!-- Seção 4: Datas -->
        <div class="secao">
          <h5>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-hourglass-split me-2" viewBox="0 0 16 16">
              <path d="M2.5 15a.5.5 0 1 1 0-1h1v-1a4.5 4.5 0 0 1 2.557-4.06c.29-.139.443-.377.443-.59v-.009c0-.213-.154-.451-.443-.59A4.5 4.5 0 0 1 3.5 3V2h-1a.5.5 0 0 1 0-1h11a.5.5 0 0 1 0 1h-1v1a4.5 4.5 0 0 1-2.557 4.06c-.29.139-.443.377-.443.59v.009c0 .213.154.451.443.59A4.5 4.5 0 0 1 12.5 13v1h1a.5.5 0 0 1 0 1zm0-14h11V2h-1a2.5 2.5 0 0 0-2.5 2.5v.006a2.5 2.5 0 0 0 2.5 2.5h1v5h-1a2.5 2.5 0 0 0-2.5 2.5v.006a2.5 2.5 0 0 0 2.5 2.5h1v2z"/>
            </svg>
            Cronograma
          </h5>
          <div class="row g-4">
            <div class="col-md-6">
              <div class="info-card info-card-red">
                <label>Início da Atividade</label>
                <p>{{ x.inicio_atividade }}</p>
              </div>
            </div>
            <div class="col-md-6">
              <div class="info-card info-card-red">
                <label>Final da Atividade</label>
                <p>{{ x.final_atividade }}</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Seção 5: Impacto Social e Área -->
        <div class="secao">
          <h5>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-flower1 me-2" viewBox="0 0 16 16">
              <path d="M6.174 1.184a.5.5 0 0 1 .652.78L6.1 2.393a3 3 0 1 1 4.788 3.894L9.5 6.393v1.214a3 3 0 1 1-3.894 4.788l-.68-.734a.5.5 0 1 1 .78-.652l.68.734a2 2 0 1 0 2.612-2.612l-1.06-1.06a2 2 0 1 0-3.894 0l1.06 1.06a2 2 0 1 0 2.612 2.612l.68-.734a.5.5 0 1 1 .78.652l-.68.734a3 3 0 1 1-4.788-3.894l1.214-.536H6.5a3 3 0 1 1-3.894-4.788l.734.68a.5.5 0 1 1-.652-.78l-.734-.68A3 3 0 1 1 6.174 1.184Z"/>
            </svg>
            Escopo e Impacto
          </h5>
          <div class="row g-4">
            <div class="col-md-6">
              <div class="info-card info-card-light-green">
                <label>Retorno para a Comunidade</label>
                <p>{{ x.retorno_comuni }}</p>
              </div>
            </div>
            <div class="col-md-6">
              <div class="info-card info-card-teal">
                <label>Área de Atuação</label>
                <p>{{ x.area_atuacao }}</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Seção 6: Arquivos -->
        <h5>
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-file-earmark-arrow-down me-2" viewBox="0 0 16 16">
            <path d="M8.5 6.5a.5.5 0 0 0-1 0v3.793L6.354 9.146a.5.5 0 1 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L8.5 10.293z"/>
            <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>
          </svg>
          Anexar arquivos
        </h5>
        <form id="fileUploadForm" class="file-upload-form" method="post" enctype="multipart/form-data" action="{% url 'info_pesquisa' x.id %}">{% csrf_token %}
          <label for="file" class="file-upload-label">
            <div class="file-upload-design">
              <svg viewBox="0 0 640 512" height="1em">
                <path
                  d="M144 480C64.5 480 0 415.5 0 336c0-62.8 40.2-116.2 96.2-135.9c-.1-2.7-.2-5.4-.2-8.1c0-88.4 71.6-160 160-160c59.3 0 111 32.2 138.7 80.2C409.9 102 428.3 96 448 96c53 0 96 43 96 96c0 12.2-2.3 23.8-6.4 34.6C596 238.4 640 290.1 640 352c0 70.7-57.3 128-128 128H144zm79-217c-9.4 9.4-9.4 24.6 0 33.9s24.6 9.4 33.9 0l39-39V392c0 13.3 10.7 24 24 24s24-10.7 24-24V257.9l39 39c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-80-80c-9.4-9.4-24.6-9.4-33.9 0l-80 80z"
                ></path>
              </svg>
              <p>Arraste e solte</p>
              <p>ou</p>
              <span class="browse-button">Selecione</span>
            </div>
            <input id="file" type="file" name="documento" />
          </label>
        </form>

        {% if documentos %}
          <h5>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-file-earmark-arrow-down me-2" viewBox="0 0 16 16">
              <path d="M8.5 6.5a.5.5 0 0 0-1 0v3.793L6.354 9.146a.5.5 0 1 0-.708.708l2 2a.5.5 0 0 0 .708 0l2-2a.5.5 0 0 0-.708-.708L8.5 10.293z"/>
              <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>
            </svg>
            Arquivos atrelados
          </h5>
          {% for j in documentos %}
            <ul>
              <li class="fs-5 rounded d-flex justify-content-center mt-2">
                  <a href="{{ j.documento.url }}" target="_blank">{{ j.documento.name }}</a>
                  {% if user.is_staff %}
                    <form method="POST" class="mt-1 ms-4" action="{% url 'excluir_arq' x.id %}">
                        {% csrf_token %}
                        <input type="hidden" name="documento_id" value="{{ j.id }}">
                        <button class="bin-button" type="submit">
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            viewBox="0 0 39 7"
                            class="bin-top"
                          >
                            <line stroke-width="4" stroke="white" y2="5" x2="39" y1="5"></line>
                            <line
                              stroke-width="3"
                              stroke="white"
                              y2="1.5"
                              x2="26.0357"
                              y1="1.5"
                              x1="12"
                            ></line>
                          </svg>
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            viewBox="0 0 33 39"
                            class="bin-bottom"
                          >
                            <mask fill="white" id="path-1-inside-1_8_19">
                              <path
                                d="M0 0H33V35C33 37.2091 31.2091 39 29 39H4C1.79086 39 0 37.2091 0 35V0Z"
                              ></path>
                            </mask>
                            <path
                              mask="url(#path-1-inside-1_8_19)"
                              fill="white"
                              d="M0 0H33H0ZM37 35C37 39.4183 33.4183 43 29 43H4C-0.418278 43 -4 39.4183 -4 35H4H29H37ZM4 43C-0.418278 43 -4 39.4183 -4 35V0H4V35V43ZM37 0V35C37 39.4183 33.4183 43 29 43V35V0H37Z"
                            ></path>
                            <path stroke-width="4" stroke="white" d="M12 6L12 29"></path>
                            <path stroke-width="4" stroke="white" d="M21 6V29"></path>
                          </svg>
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            viewBox="0 0 89 80"
                            class="garbage"
                          >
                            <path
                              fill="white"
                              d="M20.5 10.5L37.5 15.5L42.5 11.5L51.5 12.5L68.75 0L72 11.5L79.5 12.5H88.5L87 22L68.75 31.5L75.5066 25L86 26L87 35.5L77.5 48L70.5 49.5L80 50L77.5 71.5L63.5 58.5L53.5 68.5L65.5 70.5L45.5 73L35.5 79.5L28 67L16 63L12 51.5L0 48L16 25L22.5 17L20.5 10.5Z"
                            ></path>
                          </svg>
                        </button>
                    </form>
                  {% endif %}
              </li>
          </ul>
          {% endfor %}
        {% endif %}

        <!-- Seção 7: Status -->
        <div class="status-card">
          <div class="row align-items-center">
            <div class="col-auto">
              <strong>Status da Pesquisa:</strong>
            </div>
            <div class="col-auto">
              {% if x.status == True %}
                <span class="badge badge-ativo">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle-fill me-2" viewBox="0 0 16 16">
                    <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.5-4.5a.5.5 0 0 0-.5.5v5.793l-2.146-2.147a.5.5 0 0 0-.708.708l3 3a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L12.5 10.293V4a.5.5 0 0 0-.5-.5z"/>
                  </svg>
                  EM-ANDAMENTO
                </span>
              {% else %}
                <span class="badge badge-inativo">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-exclamation-circle-fill me-2" viewBox="0 0 16 16">
                    <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8 4a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 4zm.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/>
                  </svg>
                  AGUARDANDO AUTORIZAÇÃO
                </span>
              {% endif %}
            </div>
          </div>
        </div>

      </div>

      <!-- Footer -->
      <div class="relatorio-footer">
        <p>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar-check me-1" viewBox="0 0 16 16">
            <path d="M10.854 7.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 9.793l2.646-2.647a.5.5 0 0 1 .708 0z"/>
            <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4z"/>
          </svg>
          Relatório solicitado em {% for x in obj %}{{ x.data_solicitacao }}{% endfor %}
        </p>
      </div>

    </div>
    {% if not forloop.last %}
      <div class="mt-5"></div>
    {% endif %}
  {% endfor %}
</div>

{% endblock content %}

{% block js %}

  <script>
    // submete o form assim que um arquivo é selecionado
    document.getElementById('file')?.addEventListener('change', function () {
      if (this.files?.length) document.getElementById('fileUploadForm')?.submit();
    });
  </script>

{% endblock js %}